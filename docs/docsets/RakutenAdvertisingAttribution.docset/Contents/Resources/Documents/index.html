<!DOCTYPE html>
<html lang="en">
  <head>
    <title>RakutenAdvertisingAttribution  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset='utf-8'>
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
    <script src="js/lunr.min.js" defer></script>
    <script src="js/typeahead.jquery.js" defer></script>
    <script src="js/jazzy.search.js" defer></script>
  </head>
  <body>
    <a title="RakutenAdvertisingAttribution  Reference"></a>
    <header>
      <div class="content-wrapper">
        <p><a href="index.html">RakutenAdvertisingAttribution 1.0.2 Docs</a> (98% documented)</p>
        <p class="header-right"><a href="https://github.com/Rakuten-Advertising-Developers/RakutenAdvertisingAttribution-iOS-SDK"><img src="img/gh.png"/>View on GitHub</a></p>
        <p class="header-right">
          <form role="search" action="search.json">
            <input type="text" placeholder="Search documentation" data-typeahead>
          </form>
        </p>
      </div>
    </header>
    <div class="content-wrapper">
      <p id="breadcrumbs">
        <a href="index.html">RakutenAdvertisingAttribution Reference</a>
        <img id="carat" src="img/carat.png" />
        RakutenAdvertisingAttribution  Reference
      </p>
    </div>
    <div class="content-wrapper">
      <nav class="sidebar">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/IDFAFetcher.html">IDFAFetcher</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/RakutenAdvertisingAttribution.html">RakutenAdvertisingAttribution</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Enums.html">Enumerations</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Enums/AttributionError.html">AttributionError</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/LaunchType.html">LaunchType</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/PrivateKey.html">PrivateKey</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Extensions.html">Extensions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Extensions/URL.html">URL</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Protocols.html">Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Protocols/AdSupportable.html">AdSupportable</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/AttributionConfiguration.html">AttributionConfiguration</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/BackendURLProvider.html">BackendURLProvider</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/EventSenderable.html">EventSenderable</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/EventSenderableDelegate.html">EventSenderableDelegate</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/LinkResolvable.html">LinkResolvable</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/LinkResolvableDelegate.html">LinkResolvableDelegate</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/Loggable.html">Loggable</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Structs.html">Structures</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Structs/BackendInfo.html">BackendInfo</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Configuration.html">Configuration</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/ContentItemKey.html">ContentItemKey</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Event.html">Event</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/EventData.html">EventData</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Obfuscator.html">Obfuscator</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/ResolveLinkResponse.html">ResolveLinkResponse</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Typealiases.html">Type Aliases</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:29RakutenAdvertisingAttribution16EventContentItema">EventContentItem</a>
              </li>
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:29RakutenAdvertisingAttribution15EventCustomDataa">EventCustomData</a>
              </li>
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:29RakutenAdvertisingAttribution21IDFAFetcherCompletiona">IDFAFetcherCompletion</a>
              </li>
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:29RakutenAdvertisingAttribution13LaunchOptionsa">LaunchOptions</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">
        <section>
          <section class="section">
            
            <h1 id='rakutenadvertisingattribution-ios-sdk' class='heading'>RakutenAdvertisingAttribution iOS SDK</h1>

<p>Our attribution SDK enables you to track app activity, including installs and purchase events, within your affiliate program.</p>

<blockquote>
<p><strong>Important:</strong> We recommend reading through the entire SDK documentation before beginning your SDK integration to make sure everything is clear. Your Implementation Specialist is happy to answer any questions you may have. Engineering support is also available to you as needed. </p>
</blockquote>

<p><img src="https://github.com/Rakuten-Advertising-Developers/RakutenAdvertisingAttribution-iOS-SDK/workflows/PR%20Unit%20Tests/badge.svg" alt="PR Unit Tests">
<a href="https://rakuten-advertising-developers.github.io/RakutenAdvertisingAttribution-iOS-SDK-API-References/"><img src="https://raw.githubusercontent.com/Rakuten-Advertising-Developers/RakutenAdvertisingAttribution-iOS-SDK-API-References/master/docs/badge.svg" alt="RakutenAdvertisingAttribution"></a>
<img src="https://img.shields.io/github/license/Rakuten-Advertising-Developers/RakutenAdvertisingAttribution-iOS-SDK?label=License" alt="GitHub">
<img src="https://img.shields.io/badge/platform-iOS-lightgrey" alt="Platform"></p>
<h2 id='requirements' class='heading'>Requirements</h2>

<ul>
<li>iOS 11.0+</li>
<li>Xcode 11+</li>
<li>Swift 5+</li>
</ul>
<h2 id='import-the-attribution-sdk-into-your-ios-workspace' class='heading'>Import the attribution SDK into your iOS workspace</h2>
<h5 id='cocoapods' class='heading'>CocoaPods</h5>

<p>Use <a href="https://cocoapods.org">CocoaPods</a> to install attribution SDK as a pod. If you don’t have Cocoapods installed, follow this <a href="https://guides.cocoapods.org/using/getting-started">guide</a> for intallations. If you have Cocopods already installed add the following lines in your Podfile:</p>
<pre class="highlight ruby"><code><span class="n">source</span> <span class="s1">'https://github.com/CocoaPods/Specs.git'</span>
<span class="n">source</span> <span class="s1">'https://github.com/Rakuten-Advertising-Developers/Specs.git'</span>

<span class="n">target</span> <span class="s1">'YOUR_TARGET_NAME'</span> <span class="k">do</span>

  <span class="n">use_frameworks!</span>
  <span class="n">pod</span> <span class="s1">'RakutenAdvertisingAttribution'</span>

<span class="k">end</span>
</code></pre>

<p>Run the following command from your project&rsquo;s Podfile location</p>
<pre class="highlight shell"><code>pod install --repo-update 
</code></pre>
<h5 id='swift-package-manager' class='heading'>Swift Package Manager</h5>

<p>Also you can use the Swift Package Manager as integration method. If you want to use the Swift Package Manager as integration method, either <a href="https://developer.apple.com/documentation/xcode/adding_package_dependencies_to_your_app">use Xcode to add the package dependency</a> or add the following dependency to your <code>Package.swift</code>:</p>
<pre class="highlight swift"><code><span class="nv">dependencies</span><span class="p">:</span> <span class="p">[</span>
    <span class="o">.</span><span class="nf">package</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="s">"RakutenAdvertisingAttribution"</span><span class="p">,</span> 
             <span class="nv">url</span><span class="p">:</span> <span class="s">"https://github.com/Rakuten-Advertising-Developers/RakutenAdvertisingAttribution-iOS-SDK.git"</span><span class="p">,</span> 
             <span class="o">.</span><span class="nf">upToNextMajor</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="s">"1.0.0"</span><span class="p">))</span>
<span class="p">]</span>
</code></pre>
<h4 id='creating-public-private-key-pairs' class='heading'>Creating public/private key pairs</h4>

<p>To integrate the SDK into your application, you must generate public/private key pairs using the following commands.</p>
<pre class="highlight shell"><code>openssl genrsa -out rad_rsa_private.pem 4096
openssl rsa -in rad_rsa_private.pem -outform PEM -pubout -out rad_rsa_public.pem
</code></pre>

<p>The above commands will create the following two files.</p>

<ol>
<li><strong>rad_rsa_private.pem:</strong> Store this private key securely. This key is required by the SDK to report events to our attribution server in a secured manner. We recommend obfuscating the private key which is required during SDK initialization. To obfuscate the private key, follow the instructions the “Private Key Obfuscation steps” section.</li>
<li><strong>rad_rsa_public.pem:</strong> This file is required by our attribution server to verify the signature.</li>
</ol>

<blockquote>
<p><strong>Note:</strong> Email the rad_ras_public.pem public key and your app bundle id details to <a href="mailto:ra-sdk-support@mail.rakuten.com">ra-sdk-support@mail.rakuten.com</a></p>
</blockquote>
<h4 id='setup-attribution-sdk-initialization' class='heading'>Setup attribution SDK initialization</h4>

<blockquote>
<p>Optionally you can obfuscate your key <a href="https://github.com/Rakuten-Advertising-Developers/RakutenAdvertisingAttribution-iOS-SDK/blob/master/guides/KeyObfuscatingGuide.md">using the following guide</a></p>
</blockquote>

<p>In your AppDelegate <code>application:didFinishLaunchingWithOptions:</code> initialize <code><a href="Structs/Configuration.html">Configuration</a></code> struct</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">configuration</span> <span class="o">=</span> <span class="kt">Configuration</span><span class="p">(</span><span class="nv">key</span><span class="p">:</span> <span class="kt">PrivateKey</span><span class="o">.</span><span class="nf">data</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="o">&lt;</span><span class="kt">Your</span> <span class="kt">Private</span> <span class="kt">Key</span><span class="o">&gt;</span><span class="p">),</span> 
                                  <span class="nv">launchOptions</span><span class="p">:</span> <span class="n">launchOptions</span><span class="p">)</span>
</code></pre>

<blockquote>
<p>Optionally you can provide another server information, for example for stage environment</p>
</blockquote>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">backendInfo</span> <span class="o">=</span> <span class="kt">BackendInfo</span><span class="o">.</span><span class="n">stageConfiguration</span>
<span class="k">let</span> <span class="nv">configuration</span> <span class="o">=</span> <span class="kt">Configuration</span><span class="p">(</span><span class="nv">key</span><span class="p">:</span> <span class="kt">PrivateKey</span><span class="o">.</span><span class="nf">data</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="o">&lt;</span><span class="kt">Your</span> <span class="kt">Private</span> <span class="kt">Key</span><span class="o">&gt;</span><span class="p">),</span> 
                                  <span class="nv">launchOptions</span><span class="p">:</span> <span class="n">launchOptions</span><span class="p">,</span> 
                                  <span class="nv">backendURLProvider</span><span class="p">:</span> <span class="n">backendInfo</span><span class="p">)</span>
</code></pre>

<p>Then pass it to SDK</p>
<pre class="highlight plaintext"><code>RakutenAdvertisingAttribution.setup(with: configuration)
</code></pre>
<h4 id='user-consent' class='heading'>User Consent</h4>

<p>According to <a href="https://developer.apple.com/app-store/user-privacy-and-data-use/">User Privacy and Data Use</a> <strong>SDK will ignore any events until user consent will be provided</strong>. To do this you have to provide next parameters</p>
<pre class="highlight swift"><code><span class="kt">RakutenAdvertisingAttribution</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="n">adSupport</span><span class="o">.</span><span class="n">isTrackingEnabled</span> <span class="o">=</span> <span class="kc">true</span>
<span class="kt">RakutenAdvertisingAttribution</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="n">adSupport</span><span class="o">.</span><span class="n">advertisingIdentifier</span> <span class="o">=</span> <span class="o">&lt;</span><span class="kt">IDFA_VALUE</span><span class="o">&gt;</span>
</code></pre>

<p>You can also retrive this value via <code>ASIdentifierManager</code> by yourself or using <code><a href="Classes/IDFAFetcher.html">IDFAFetcher</a></code> helper class which provided as part of SDK.</p>

<p><code>fetchIfAuthorized</code> checks current user&rsquo;s consent state and fetch values. It&rsquo;s common practise to call this function along with SDK configuration code and provide needed IDFA values as soon as possible.</p>
<pre class="highlight swift"><code><span class="kt">IDFAFetcher</span><span class="o">.</span><span class="n">fetchIfAuthorized</span> <span class="p">{</span>
    <span class="kt">RakutenAdvertisingAttribution</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="n">adSupport</span><span class="o">.</span><span class="n">isTrackingEnabled</span> <span class="o">=</span> <span class="nv">$0</span>
    <span class="kt">RakutenAdvertisingAttribution</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="n">adSupport</span><span class="o">.</span><span class="n">advertisingIdentifier</span> <span class="o">=</span> <span class="nv">$1</span><span class="o">.</span><span class="n">uuidString</span>
<span class="p">}</span>
</code></pre>

<p>In case you haven&rsquo;t ask user&rsquo;s consent previously, call <code>requestTracking</code> function to do this, at an appropriate time in your app (SDK will ignore all events until receive consent from user)</p>
<pre class="highlight swift"><code><span class="kt">IDFAFetcher</span><span class="o">.</span><span class="n">requestTracking</span> <span class="p">{</span>
    <span class="kt">RakutenAdvertisingAttribution</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="n">adSupport</span><span class="o">.</span><span class="n">isTrackingEnabled</span> <span class="o">=</span> <span class="nv">$0</span>
    <span class="kt">RakutenAdvertisingAttribution</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="n">adSupport</span><span class="o">.</span><span class="n">advertisingIdentifier</span> <span class="o">=</span> <span class="nv">$1</span><span class="o">.</span><span class="n">uuidString</span>
<span class="p">}</span>
</code></pre>

<blockquote>
<p>Don&rsquo;t forget to add to Info.plist tracking usage description information</p>
<pre class="highlight xml"><code><span class="nt">&lt;key&gt;</span>NSUserTrackingUsageDescription<span class="nt">&lt;/key&gt;</span>
<span class="nt">&lt;string&gt;</span>This identifier will be used to deliver personalized ads to you.<span class="nt">&lt;/string&gt;</span>
</code></pre>
</blockquote>
<h4 id='handling-install-and-open-events-along-with-deeplink-data' class='heading'>Handling INSTALL and OPEN events along with deeplink data</h4>

<p>Our attribution SDK provides a function (resolve) to capture app install events automatically.
Simply call the <code>RakutenAdvertisingAttribution.shared.linkResolver.resolve</code> function in AppDeletgate foreground method.
In your AppDelegate use:</p>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">application</span><span class="p">(</span><span class="n">_</span> <span class="nv">app</span><span class="p">:</span> <span class="kt">UIApplication</span><span class="p">,</span> <span class="kd">open</span> <span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[</span><span class="kt">UIApplication</span><span class="o">.</span><span class="kt">OpenURLOptionsKey</span><span class="p">:</span> <span class="kt">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[:])</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>

    <span class="kt">RakutenAdvertisingAttribution</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="n">linkResolver</span><span class="o">.</span><span class="nf">resolve</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">true</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">application</span><span class="p">(</span><span class="n">_</span> <span class="nv">application</span><span class="p">:</span> <span class="kt">UIApplication</span><span class="p">,</span>
                <span class="k">continue</span> <span class="nv">userActivity</span><span class="p">:</span> <span class="kt">NSUserActivity</span><span class="p">,</span>
                <span class="nv">restorationHandler</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">([</span><span class="kt">UIUserActivityRestoring</span><span class="p">]?)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>

    <span class="kt">RakutenAdvertisingAttribution</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="n">linkResolver</span><span class="o">.</span><span class="nf">resolve</span><span class="p">(</span><span class="nv">userActivity</span><span class="p">:</span> <span class="n">userActivity</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">true</span>
<span class="p">}</span>
</code></pre>

<p>Optionally you can use <code>delegate</code> property of <code>linkResolver</code>, to handle data from the <a href="https://rakuten-advertising-developers.github.io/RakutenAdvertisingAttribution-iOS-SDK-API-References/Structs/ResolveLinkResponse.html">response</a></p>
<pre class="highlight swift"><code><span class="kd">class</span> <span class="kt">LinkResolveHandler</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">LinkResolveHandler</span><span class="p">:</span> <span class="kt">LinkResolvableDelegate</span> <span class="p">{</span>

    <span class="kd">func</span> <span class="nf">didResolveLink</span><span class="p">(</span><span class="nv">response</span><span class="p">:</span> <span class="kt">ResolveLinkResponse</span><span class="p">)</span> <span class="p">{</span>

        <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">async</span> <span class="p">{</span>
            <span class="c1">// handle response</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">didFailedResolve</span><span class="p">(</span><span class="nv">link</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="n">with</span> <span class="nv">error</span><span class="p">:</span> <span class="kt">Error</span><span class="p">)</span> <span class="p">{</span>

        <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">async</span> <span class="p">{</span>
            <span class="c1">// error case handling</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="o">...</span>

<span class="k">var</span> <span class="nv">handler</span> <span class="o">=</span> <span class="kt">LinkResolveHandler</span><span class="p">()</span>

<span class="o">...</span>

<span class="kt">RakutenAdvertisingAttribution</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="n">linkResolver</span><span class="o">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="n">handler</span>

</code></pre>

<p>When the app launches for the first time after installation, the resolve() method flags the session as the first session and our attribution server records the event as an INSTALL.</p>

<blockquote>
<p><strong>Important:</strong> When <code>resolve()</code> is called, our attribution server will attempt to attribute the event to an affiliate link referral. Please follow your business requirement on when to call <code>resolve()</code>.  Any excluding logic is the individual developer’s responsibility; however, we have included the following sample code to illustrate how to call <code>resolve()</code> for specific traffic.</p>
</blockquote>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">shouldIgnoreLinkResolver</span><span class="p">(</span><span class="nv">userActivity</span><span class="p">:</span> <span class="kt">NSUserActivity</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
    <span class="k">guard</span> <span class="n">userActivity</span><span class="o">.</span><span class="n">activityType</span> <span class="o">==</span> <span class="kt">NSUserActivityTypeBrowsingWeb</span><span class="p">,</span>
          <span class="k">let</span> <span class="nv">incomingURL</span> <span class="o">=</span> <span class="n">userActivity</span><span class="o">.</span><span class="n">webpageURL</span><span class="p">,</span>
          <span class="k">let</span> <span class="nv">host</span> <span class="o">=</span> <span class="n">incomingURL</span><span class="o">.</span><span class="n">host</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">false</span> <span class="p">}</span>
    <span class="k">let</span> <span class="nv">excludedDomains</span><span class="p">:</span> <span class="kt">Set</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">[</span><span class="s">"example.com"</span><span class="p">,</span> <span class="s">"excluded.com"</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">excludedDomains</span><span class="o">.</span><span class="nf">contains</span><span class="p">(</span><span class="n">host</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">application</span><span class="p">(</span><span class="n">_</span> <span class="nv">application</span><span class="p">:</span> <span class="kt">UIApplication</span><span class="p">,</span> <span class="k">continue</span> <span class="nv">userActivity</span><span class="p">:</span> <span class="kt">NSUserActivity</span><span class="p">,</span> <span class="nv">restorationHandler</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">([</span><span class="kt">UIUserActivityRestoring</span><span class="p">]?)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
    <span class="k">if</span> <span class="o">!</span><span class="nf">shouldIgnoreLinkResolver</span><span class="p">(</span><span class="nv">userActivity</span><span class="p">:</span> <span class="n">userActivity</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">RakutenAdvertisingAttribution</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="n">linkResolver</span><span class="o">.</span><span class="nf">resolve</span><span class="p">(</span><span class="nv">userActivity</span><span class="p">:</span> <span class="n">userActivity</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="k">return</span> <span class="kc">true</span>
<span class="p">}</span>
</code></pre>
<h4 id='handling-purchase-events' class='heading'>Handling Purchase Events</h4>

<p>Our attribution SDK provides a function <code>RakutenAdvertisingAttribution.shared.eventSender</code> to capture in-app purchase events.  Upon successfully completing the order processing routine, call the <code>RakutenAdvertisingAttribution.shared.eventSender</code> function passing details about the purchase.</p>

<p>Sample purchase event reporting code:</p>
<pre class="highlight swift"><code><span class="c1">// Item level details (item1)</span>
<span class="k">let</span> <span class="nv">content1</span><span class="p">:</span> <span class="kt">EventContentItem</span> <span class="o">=</span> <span class="p">[</span><span class="o">.</span><span class="nv">price</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
                                  <span class="o">.</span><span class="nv">quantity</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                                  <span class="o">.</span><span class="nv">sku</span><span class="p">:</span> <span class="s">"788672541568328428"</span><span class="p">,</span>
                                  <span class="o">.</span><span class="nv">productName</span><span class="p">:</span> <span class="s">"First Product Name"</span><span class="p">]</span>
<span class="c1">// Item level details (item2)</span>
<span class="k">let</span> <span class="nv">content2</span><span class="p">:</span> <span class="kt">EventContentItem</span> <span class="o">=</span> <span class="p">[</span><span class="o">.</span><span class="nv">price</span><span class="p">:</span> <span class="mi">150</span><span class="p">,</span>
                                  <span class="o">.</span><span class="nv">quantity</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                                  <span class="o">.</span><span class="nv">sku</span><span class="p">:</span> <span class="s">"788672541527138674"</span><span class="p">,</span>
                                  <span class="o">.</span><span class="nv">productName</span><span class="p">:</span> <span class="s">"Second Product Name"</span><span class="p">]</span>
<span class="c1">// if you have more items continue with content3, content4 and so on and include in the Event() as below</span>
<span class="c1">// Order details </span>
<span class="k">let</span> <span class="nv">eventData</span> <span class="o">=</span> <span class="kt">EventData</span><span class="p">(</span><span class="nv">transactionId</span><span class="p">:</span> <span class="s">"12345"</span><span class="p">,</span>
                                         <span class="nv">currency</span><span class="p">:</span> <span class="s">"USD"</span><span class="p">,</span>
                                         <span class="nv">revenue</span><span class="p">:</span> <span class="mi">415</span><span class="p">,</span>
                                         <span class="nv">shipping</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>
                                         <span class="nv">tax</span><span class="p">:</span> <span class="mi">7</span><span class="p">)</span>                                
<span class="k">let</span> <span class="nv">event</span> <span class="o">=</span> <span class="kt">Event</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="s">"PURCHASE"</span><span class="p">,</span>
                  <span class="nv">eventData</span><span class="p">:</span> <span class="n">eventData</span><span class="p">,</span>
                  <span class="nv">contentItems</span><span class="p">:</span> <span class="p">[</span><span class="n">content1</span><span class="p">,</span> <span class="n">content2</span><span class="p">])</span>
<span class="kt">RakutenAdvertisingAttribution</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="n">eventSender</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="nv">event</span><span class="p">:</span> <span class="n">event</span><span class="p">)</span>
</code></pre>

<p>Similarly, you can use <code>delegate</code> property of <code>eventSender</code>, to track status of sending events</p>
<pre class="highlight swift"><code><span class="kd">class</span> <span class="kt">EventSenderHandler</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">EventSenderHandler</span><span class="p">:</span> <span class="kt">EventSenderableDelegate</span> <span class="p">{</span>

    <span class="kd">func</span> <span class="nf">didSend</span><span class="p">(</span><span class="nv">eventName</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">resultMessage</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>

        <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">async</span> <span class="p">{</span>
            <span class="c1">// handle result</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">didFailedSend</span><span class="p">(</span><span class="nv">eventName</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="n">with</span> <span class="nv">error</span><span class="p">:</span> <span class="kt">Error</span><span class="p">)</span> <span class="p">{</span>

        <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">async</span> <span class="p">{</span>
            <span class="c1">// error case handling</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="o">...</span>

<span class="k">var</span> <span class="nv">handler</span> <span class="o">=</span> <span class="kt">EventSenderHandler</span><span class="p">()</span>

<span class="o">...</span>

<span class="kt">RakutenAdvertisingAttribution</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="n">eventSender</span><span class="o">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="n">handler</span>

</code></pre>
<h4 id='debugging' class='heading'>Debugging</h4>

<p>For debugging enable the logger as below:</p>
<pre class="highlight swift"><code><span class="kt">RakutenAdvertisingAttribution</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="kc">true</span>
</code></pre>

<p>Once the logging flag enabled, you will be able to see resolve() and sendEvent() request and response payloads in the debug console.</p>

<p>Sample debug log:</p>
<pre class="highlight plaintext"><code>RakutenAdvertisingAttribution.Logger 
-----&gt;
POST https://attribution-sdk-endpoint-z7j3tzzl4q-uc.a.run.app/v2/resolve-link-rak
HEADERS: {
  "Content-Type" : "application\/json",
  "Authorization" : "Bearer eyJ0eX &lt;...&gt; EuY"
}
BODY: {
  "device_data" : {
    "is_simulator" : true,
    "os" : "iOS",
    "device_id" : "DA128118-C52B-4EAA-9F65-4C6A6F686F66",
    "screen_width" : 414,
    "model" : "iPhone",
    "os_version" : "14.0",
    "screen_height" : 896,
    "ios_vendor_id" : "DA128118-C52B-4EAA-9F65-4C6A6F686F66",
    "fingerprint" : "{\"userAgent\":\"Mozilla\/5.0 (iPhone; CPU iPhone OS 14_0 like Mac OS X) AppleWebKit\/605.1.15 (KHTML, like Gecko) Mobile\/15E148\",\"webdriver\":false,\"language\":\"en-us\",\"colorDepth\":32,\"deviceMemory\":\"not available\",\"pixelRatio\":2,\"hardwareConcurrency\":\"not available\",\"screenResolution\":[896,414],\"availableScreenResolution\":[896,414],\"timezoneOffset\":-180,\"timezone\":\"Europe\/Kiev\",\"sessionStorage\":true,\"localStorage\":true,\"indexedDb\":true,\"addBehavior\":false,\"openDatabase\":false,\"cpuClass\":\"not available\",\"platform\":\"iPhone\",\"doNotTrack\":\"not available\",\"webglVendorAndRenderer\":\"Apple Inc.~Apple GPU\",\"adBlock\":false,\"hasLiedLanguages\":false,\"hasLiedResolution\":false,\"hasLiedOs\":false,\"hasLiedBrowser\":false,\"touchSupport\":[5,true,true],\"fontsFlash\":\"swf object not loaded\",\"audio\":\"35.10892752557993\",\"ip\":\"192.168.1.2\"}",
    "hardware_id_type" : "vendor_id"
  },
  "universal_link_url" : "",
  "first_session" : false,
  "user_data" : {
    "sdk_version" : "1.0.0",
    "bundle_identifier" : "com.rakutenadvertising.RADAttribution-Example",
    "app_version" : "1.0.0"
  }
}
-----&gt;

RakutenAdvertisingAttribution.Logger 
&lt;-----
POST https://attribution-sdk-endpoint-z7j3tzzl4q-uc.a.run.app/v2/resolve-link-rak
CODE: 200
RESPONSE: {
  "session_id" : "5f6c7374421aa900012733c4",
  "link" : "",
  "click_timestamp" : 0,
  "device_fingerprint_id" : "5f6c7374421aa9000127343f"
}
&lt;-----
</code></pre>

<blockquote>
<p><strong>IMPORTANT:</strong> We recommend disabling debugging in the production build.</p>
</blockquote>
<h2 id='demo-app' class='heading'>Demo app</h2>

<p>We provide a sample app that demonstrate the use of the Rakuten Advertising attribution SDK. You can find the open source application at this Git Repsitory</p>

<ul>
<li><a href="https://github.com/Rakuten-Advertising-Developers/radadvertiser-demo-ios/">RAd Advertiser Demo</a></li>
</ul>
<h2 id='example' class='heading'>Example</h2>

<p>To run the example project, clone the repo, and run <code>pod install</code> from the Example directory first.</p>
<h2 id='usage' class='heading'>Usage</h2>

<blockquote>
<p>All examples require <code>import RakutenAdvertisingAttribution</code> somewhere in the source file.</p>
</blockquote>
<h2 id='documentation' class='heading'>Documentation</h2>

<ul>
<li><a href="https://rakuten-advertising-developers.github.io/RakutenAdvertisingAttribution-iOS-SDK-API-References/">API References</a></li>
</ul>
<h2 id='author' class='heading'>Author</h2>

<p>Rakuten Advertising</p>
<h2 id='license' class='heading'>License</h2>

<p>RakutenAdvertisingAttribution iOS SDK is available under the MIT license. See the <a href="https://github.com/Rakuten-Advertising-Developers/RakutenAdvertisingAttribution-iOS-SDK/blob/master/LICENSE">LICENSE</a> file for more info.</p>

          </section>
        </section>
        <section id="footer">
          <p>&copy; 2021 <a class="link" href="https://github.com/Rakuten-Advertising-Developers/" target="_blank" rel="external">Rakuten Advertising</a>. All rights reserved. (Last updated: 2021-08-18)</p>
          <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.13.6</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external">Realm</a> project.</p>
        </section>
      </article>
    </div>
  </body>
</div>
</html>
